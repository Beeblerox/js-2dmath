<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" ></script>
<title>js-2dmath: Some Vec2 functions in action</title>

<script src="../debug/js-2dmath-browser-debug.js" type="text/javascript" ></script>

</head>
<body>
<h1>js-2dmath: Some Vec2 functions in action</h1>
<canvas id="canvas-axis" width="640" height="640" style="position: absolute; border: 2px solid blue;"></canvas>
<canvas id="canvas" width="640" height="640" style="position: absolute; z-index: 10; border: 1px solid red;"></canvas>
</body>
</html>

<script>

/**
* @source http://chrishecker.com/Rigid_Body_Dynamics
* @source http://www.wildbunny.co.uk/blog/2011/04/06/physics-engines-for-dummies/
* @source http://physics.gac.edu/~miller/jterm_2013/physics_engine_tutorial.html
*/

require("js-2dmath").globalize(window);

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");

var canvas_axis = document.getElementById("canvas-axis");
var ctx_axis = canvas_axis.getContext("2d");

function World(maxdt, max_iterations gravity) {
    this.gravity = gravity || [0, -9.8];
    this.maxdt = maxdt;
    this.max_iterations = max_iterations || 10;
}
World.prototype.bodies = [];
World.prototype.maxdt = maxdt;
World.prototype.gravity = [0, -9.8];
World.prototype._update = function(dt) {
    // fix dt
}
World.prototype.update = function(dt) {
    // gravity
    // collisions
    // - air friction
    // - ground friction
    // integrate
}

World.prototype.forEachBody = function(fn) {
    var i = 0,
        bs = this.bodies,
        max = bs.length

    for (i = 0; i < max; ++i) {

    }
}

function Body(body, mass, restitution) {
    this.body = body;
    this.type = "polygon";
    this.restitution = restitution || 0;
    this.mass = mass || 1;
    if (mass === 0) {
        this.imass = 0;
        this.nimass = 0;
    } else {
        this.imass = 1 / mass;
        this.nimass = -(1 / mass);
    }
    this.matrix = Matrix23.create();
    this.matrix[7] = true;
    this.wbody = [];

    this.moi = Polygon.area(body) *
}

Body.prototype.translate2 = function (x, y) {
    Matrix23.translate(this.matrix, this.matrix, [x, y]);
    this.position[0] = x;
    this.position[1] = y;
}
Body.prototype.update = function () {
    if (this.matrix[7]) {
        this.matrix[7] = false;

        Polygon.transform(this.wbody, this.body, this.matrix);
    }
}
Body.prototype.position = [0, 0];
Body.prototype.velocity = [0, 0];
Body.prototype.avelocity = 0;

Body.prototype.torque = 0;
Body.prototype.orientation = 0;

Body.prototype.restitution = 0;
Body.prototype.mass = 0;
Body.prototype.imass = 0;
Body.prototype.nimass = 0;
Body.prototype.matrix = [];
Body.prototype.wbody = [];
Body.prototype.moi = 0;


var b1 = new Body (Polygon.fromCircle(Circle.create(0, 0, 50), 10, 0));
var b2 = new Body (Polygon.fromCircle(Circle.create(0, 0, 50), 10, Math.PI / 16));

b1.translate2(0, 150);

function update() {
    ctx.save();
    canvas.width = canvas.width;
    Draw.invertAxis(canvas, ctx); // y-up
    ctx.translate(canvas.width * 0.5, canvas.height * 0.5); // center

    window.requestAnimFrame(update);

    b1.update();
    b2.update();

    Draw.polygon(ctx, b1.wbody, "red");
    Draw.polygon(ctx, b2.wbody, "blue");

    ctx.restore();
};
window.requestAnimFrame(update);

Draw.invertAxis(canvas_axis, ctx); // y-up
ctx_axis.translate(canvas_axis.width * 0.5, canvas_axis.height * 0.5); // center
Draw.cartesianAxis(ctx_axis, 320, 16); // coordinates

</script>