<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" ></script>
<title>js-2dmath: Polygon</title>

<script src="../js-2dmath-browser.js" type="text/javascript" ></script>

</head>
<body>
<h1>js-2dmath: Polygon</h1>
<canvas id="canvas" width="680" height="680" style="border: 1px solid red;"></canvas>
<p>Press keys to run tests</p>
<ul>
    <li>1 - boxes collide</li>
    <li>2 - boxes no collisions</li>
</ul>
</body>
</html>

<script>
//
// --- INIT ---
//
//expose js-2dmath globally, I'm lazy!
require("js-2dmath").globalize(window);

var canvas = document.getElementById("canvas");
var ctx = canvas.getContext("2d");

//
// code
//

var poly1 = Polygon.create([0, 0], [50, 0], [50, 50], [0, 50]),
    poly2 = Polygon.create([5, 5], [50, 0], [50, 50], [0, 50]);
    poly3 = [];

function gjk(poly1, poly2) {
    Draw.polygon(ctx, poly1, "cyan");
    Draw.polygon(ctx, poly2, "blue");

    var simplex = [];
    var collision = Polygon.GJK(poly1, poly2, simplex);

    Draw.text(ctx, collision ? "collide" : "no collision", [-320, 200])

    Draw.polygon(ctx, simplex, "purple");
    Draw.polygon(ctx, simplex, "red");
}

function example1 () {
    var poly1 = Polygon.create([0, 0], [50, 0], [50, 50], [0, 50]),
        poly2 = Polygon.create([5, 5], [50, 0], [50, 50], [0, 50]);

    gjk(poly1, poly2);
}


function example2() {
    var poly1 = Polygon.create([0, 0], [50, 0], [50, 50], [0, 50]),
        poly2 = Polygon.create();

    Polygon.translate(poly2, poly1, [100, 100]);
    gjk(poly1, poly2);
}

function example3() {
    var poly1 = Polygon.create([0, 0], [50, 0], [50, 50], [0, 50]),
        poly2 = Polygon.create([25, 25], [60, 25], [50, 50], [25, 50]);

    gjk(poly1, poly2);
}

function example4() {
    var poly1 = Polygon.create([50, -40], [0, -80], [-50, -40]),
        poly2 = Polygon.create([50, -40], [0, -80], [-50, -40]);

    Polygon.translate(poly2, poly1, [10, 10]);
    Polygon.rotate(poly2, poly2, Math.DEG_TO_RAD * 15);
    gjk(poly1, poly2);
}

var current_test = example3;

function onKeyDown(ev) {
    if (!ev) {
        ev = event;
    }

    switch (ev.keyCode) {
    case 49: // '1'
    case 50: // '2'
    case 51: // '3'
    case 52: // '4'
    case 53: // '5'
    case 54: // '6'
    case 55: // '7'
        current_test = window["example" + (ev.keyCode - 48)]
        if (!current_test) {
            current_test = example1;
        }

        window.requestAnimFrame(update);
        break;
    }

}
document.addEventListener("keydown", onKeyDown, false);

function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height); // center
    ctx.save();

    Draw.invertAxis(canvas, ctx); // y-up
    ctx.translate(canvas.width * 0.5, canvas.height * 0.5); // center
    Draw.cartesianAxis(ctx, 320, 16); // coordinates


    current_test();

    ctx.restore();

}
update();

</script>


